<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What is My IP Address</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/normalize/8.0.1/normalize.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="icon" type="image/png" sizes="16x16"
        href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAMAAAD04JH5AAAAeFBMVEUAAAARltsSldkQk9sSl9sSltoTldsSltwSltwSltwRltsTltsSltsRl9sSltsRlt0SltsSl9sSldsQltkSldwSl9sSltsSltsTltwQltoRltwTl9wTldwRl9wSmNsXl9wSldoTltkSl9wRltsSldwRltsMkNMSlts4wY/mAAAAJ3RSTlMAv4BA5WAa7tnDVrOrzVwO3rhjLiX5pY1NPJJRQoI5FsGInml2lgX0j+4HAAADZklEQVR42uzXW5KqUAyF4YVyVW6KKHhttTXzn+E5Vfqy3TQBEnjyG0DzVxckEV9fX1+D+LV32kZJ6AZlGbhhEm1PXu1jGv7iFlCj4LYYPaKYOdTKmRUYTeYtqYOll2EM571LHbn7M7RVMfUSV9C0/qHeftbQclzRIKsjNFx2NNjuArE0JIEwhdCVhK6Q2CxJbLnBYIecFOQHDHQnJXcMMiM1M+nz5QXS509fkJKyFL0sSN1C8PzJCw40igM62uQ0inyDbqz5mzxmAzwSayoP2j/5IcNA2ecsvw74AGOIxL0/xou5/48QOpr3wQUc8/75hdiveSP1C3agwOn1L10xe1S81VfM/U2GGgpqMqzRxrz/yycUPEvz9wJaVGRIoCIhQ9X9q3Wgwuk8Wc40RQCd8Zf9NAF7/CFzpwlwMzTziA1w6GVu//HSzZPoNH/yAeQxa7hngMndX9iAJRoVNCjAEqZcABXMIS4KsFeY0/FIj9QCyGMCIjTwSS+AivYA8mFbawbsmIA1bLFmQOC3B8SwBaKA1z1f3eht0R4QwOKTLODt0fCeO9TlJailAeYw2TIBtT2HdQIyelkxAfY0PkkDzI1+YwJO+LTVCYg6vgNbew7KAub/VfdHTm8FExAxh5t0DkRgAhJ8ClUDUi4gxCdXMyAGF+Ayg1AWkGRsgD0KS72A2wZsQDleQPyvfbPbQRCGoXBDYMr8BYwgMdHoxd7/Db3x7kQ7re2G4bsm5CSwtmtPT0QRAnQ+wb4ZBwLiPkEpjwMdVMSf/IRLoQACPjyGG1sBGIhqWwE1JiNbAUdMx7YCMB1XtgIqLMlsBWBJ5mwFOAIWlgIWhNwsBdwI8ZYCfOzlVAJ/OcXn5AIkLy50BfANis5OQBfZpCrpJ5SxsyOMxgf6AQcmDkOjEk6LEB9iG5U0YtKUg4l+ZJrVejMjbFbzfSIS8+bahAxYOu1IxA5LvYEZ2eAvK6AKwJUZWiFN7913zse+CUjLje2UadjBpTJnfnSrSh8zvFZkeTH1zyBboYHOyFq3CkqspmJiSW7jIboHBe7WVjYsRJMqKKZm54OApB6AEK9lpLNX4Kdq601vbE5v7c7A3J7e3p9+wSGDFY8MllwyWPPJYNHpuepVh7fURUfKuHb9atlt3Tp6zd+s+83MzPwbD5YeuuVggzJ1AAAAAElFTkSuQmCC" />
</head>

<body>
    <div class="row" style="margin-top: 20px">
        <div class="col-md-1"></div>
        <div class="col-md-10">
            <table class="table table-striped" style="width: 100%;">
                <tr class="taobao">
                    <td width="60px">国内</td>
                    <td width="60px">淘宝</td>
                    <td><span class="ip"></span></td>
                    <td><span class="isp"></span></td>
                </tr>
                <tr class="api345">
                    <td width="60px">国内</td>
                    <td width="60px">345API</td>
                    <td><span class="ip"></span></td>
                    <td><span class="isp"></span></td>
                </tr>
                <tr class="baidu">
                    <td width="60px">国内</td>
                    <td width="60px">百度</td>
                    <td><span class="ip"></span></td>
                    <td><span class="isp"></span></td>
                </tr>
                <tr class="st">
                    <td width="60px">国内</td>
                    <td width="60px">SpeedTestCn</td>
                    <td><span class="ip"></span></td>
                    <td><span class="isp"></span></td>
                </tr>
                <tr class="ipsb">
                    <td width="60px">国外</td>
                    <td width="60px">IPSB</td>
                    <td><span class="ip"></span></td>
                    <td><span class="isp"></span></td>
                </tr>
                <tr class="ip-api">
                    <td width="60px">国外</td>
                    <td width="60px">IP-API</td>
                    <td><span class="ip"></span></td>
                    <td><span class="isp"></span></td>
                </tr>
                <tr class="ipinfo">
                    <td width="60px">国外</td>
                    <td width="60px">IPInfo</td>
                    <td><span class="ip"></span></td>
                    <td><span class="isp"></span></td>
                </tr>
            </table>
        </div>
        <div class="col-md-1"></div>
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/1.12.1/jquery.min.js"></script>
    <script>
        function fetchJson(url) {
            return fetch(url).then(res => {
                return res.json()
            })
        }
        function showHtml(keyword, ip, text) {
            document.querySelector('.' + keyword + ' .ip').innerHTML = ip;
            document.querySelector('.' + keyword + ' .isp').innerHTML = text;
        }
        function area(country, region, city, isp) {
            return [country, region, city, isp].filter(val => !!val).join(', ')
        }

        function getIpInfo(ip) {
            return fetchJson('https://api.skk.moe/network/parseIp/v2/' + ip).then(data => {
                let country = data.country;
                let isp = data.as;

                if (country.toLowerCase() === 'china') {
                    country = '中国'
                }

                if (isp.toLowerCase().indexOf('china telecom') > -1 && isp.indexOf('电信') === -1) {
                    isp = `电信 ${isp}`
                }
                if (isp.toLowerCase().indexOf('china unicom') > -1 && isp.indexOf('联通') === -1) {
                    isp = `联通 ${isp}`
                }
                if (isp.toLowerCase().indexOf('china mobile') > -1 && isp.indexOf('移动') === -1) {
                    isp = `移动 ${isp}`
                }
                return area(country, data.regionName, data.city, isp);
            })
        }
        function getTaobaoIP() {
            return new Promise((resolve, reject) => {
                jQuery.ajax({
                    url: 'https://www.taobao.com/help/getip.php',
                    dataType: "jsonp",
                    jsonpCallback: 'ipCallback',
                    success: function (data) {
                        resolve(data.ip)
                    }
                });
            });
        }

        function getSpeedTestCnIP() {
            return fetchJson('https://forge.speedtest.cn/api/location/info')
        }

        function getUpYunIP() {
            return fetchJson('https://pubstatic.b0.upaiyun.com/?_upnode&t=' + Math.random().toString().slice(10))
        }

        function getBaiduIp() {
            return fetchJson(`https://qifu-api.baidubce.com/ip/local/geo/v1/district`)
        }
        function get345ApiIp() {
            return fetchJson(`https://www.345api.cn/api/ipv2/query`)
        }

        function getIpSb() {
            return fetchJson(`https://api-ipv4.ip.sb/geoip`)
        }
        function getIpApi() {
            return fetchJson(`https://pro.ip-api.com/json/?fields=16985625&key=EEKS6bLi6D91G1p`)
        }
        function getIpInfoApi() {
            return fetchJson(`https://ipinfo.io/json?token=d811bd45b5fcf5`)
        }

        function start() {
            getTaobaoIP().then(ip => {
                getIpInfo(ip).then(txt => {
                    showHtml('taobao', ip, txt);
                })
            })

            getSpeedTestCnIP().then(data => {
                const ip = data.full_ip;
                const txt = area(data.country, data.province, data.distinct, data.isp)
                showHtml('st', ip, txt);
            })

            get345ApiIp().then(data => {
                const ip = data.user_ip;
                getIpInfo(ip).then(txt => {
                    showHtml('api345', ip, txt);
                })
            })

            getBaiduIp().then((data) => {
                const ip = data.ip || '获取失败';
                const txt = area(data.data.country, data.data.prov, data.data.city, data.data.isp)
                showHtml('baidu', ip, txt);
            });

            getIpSb().then((data) => {
                const ip = data.ip;
                const txt = area(data.country, '', '', data.isp)
                showHtml('ipsb', ip, txt);
            })

            getIpApi().then((data) => {
                const ip = data.query;
                const txt = area(data.country, '', data.city, data.isp)
                showHtml('ip-api', ip, txt);
            })

            getIpInfoApi().then((data) => {
                const ip = data.ip;
                const txt = area(data.country, data.region, data.city, data.org)
                showHtml('ipinfo', ip, txt);
            })
        }

        start();
    </script>
</body>

</html>